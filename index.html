<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .search-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .search-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #2196F3, #3F51B5);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        .search-results {
            display: none;
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid #e0e0e0;
        }

        .form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .document-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .document-card {
            background: white;
            border: 2px dashed #d0d7de;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .document-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.1);
        }

        .document-card.uploaded {
            border-color: #28a745;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0fff0 100%);
        }

        .document-card.found {
            border-color: #ffc107;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
        }

        .document-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.6;
        }

        .document-card.uploaded .upload-icon {
            color: #28a745;
            opacity: 1;
        }

        .document-card.found .upload-icon {
            color: #ffc107;
            opacity: 1;
        }

        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #2c3e50;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .notification.warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .notification.error {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: 600;
            text-align: center;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .file-preview {
            margin-top: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #666;
        }

        .existing-record {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .existing-record:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .record-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .record-details {
            color: #666;
            font-size: 0.9rem;
        }

        .badge {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .document-types {
                grid-template-columns: 1fr;
            }

            .search-box {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üóÇÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</h1>
            <p>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ 4 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
        </div>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà -->
        <div class="search-section">
            <h3>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß</h3>
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
                <button class="search-btn" onclick="searchExistingDocuments()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            </div>
            <div class="search-results" id="searchResults"></div>
        </div>

        <form id="documentForm">
            <div class="form-section">
                <h3>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
                <div class="form-group">
                    <label for="salesPerson">üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢:</label>
                    <select id="salesPerson" name="salesPerson" required>
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢ --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="customerName">üè¢ ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</label>
                    <input type="text" id="customerName" name="customerName" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
                </div>
            </div>

            <div class="form-section">
                <h3>üìÅ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ 0/4</div>

                <div class="document-types">
                    <div class="document-card" data-type="sms">
                        <div class="upload-icon">üì±</div>
                        <h3>‡∏£‡∏π‡∏õ SMS</h3>
                        <p>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ SMS</p>
                        <input type="file" class="file-input" accept="image/*" data-type="sms">
                        <div class="file-preview" id="preview-sms" style="display: none;"></div>
                    </div>

                    <div class="document-card" data-type="checklist">
                        <div class="upload-icon">‚úÖ</div>
                        <h3>‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</h3>
                        <p>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</p>
                        <input type="file" class="file-input" accept="image/*,application/pdf" data-type="checklist">
                        <div class="file-preview" id="preview-checklist" style="display: none;"></div>
                    </div>

                    <div class="document-card" data-type="ddms">
                        <div class="upload-icon">üßæ</div>
                        <h3>‡πÉ‡∏ö‡∏ï‡∏±‡∏î‡∏Ç‡∏≤‡∏¢ DDMS</h3>
                        <p>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡∏ï‡∏±‡∏î‡∏Ç‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö DDMS</p>
                        <input type="file" class="file-input" accept="image/*,application/pdf" data-type="ddms">
                        <div class="file-preview" id="preview-ddms" style="display: none;"></div>
                    </div>

                    <div class="document-card" data-type="tax">
                        <div class="upload-icon">üìÑ</div>
                        <h3>‡πÉ‡∏ö‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ</h3>
                        <p>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ</p>
                        <input type="file" class="file-input" accept="image/*,application/pdf" data-type="tax">
                        <div class="file-preview" id="preview-tax" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <button type="button" class="submit-btn" id="saveBtn" onclick="saveDocuments()">
                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
            </button>

            <button type="submit" class="submit-btn" id="submitBtn" disabled>
                üöÄ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ñ‡∏£‡∏ö 4 ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)
            </button>
        </form>

        <div id="statusMessage" style="display: none;"></div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification"></div>

    <script>
        // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel
        const salesPeopleList = [
            "‡∏ô.‡∏™. ‡∏Å‡∏±‡∏ô‡∏ï‡∏µ‡∏ì‡∏µ‡∏¢‡πå ‡πÄ‡∏à‡πä‡∏∞‡πÅ‡∏ß",
            "‡∏ô.‡∏™. ‡∏ô‡∏π‡∏£‡∏µ‡∏ã‡∏±‡∏° ‡πÄ‡∏à‡πä‡∏∞‡∏°‡∏¥‡∏á",
            "‡∏ô.‡∏™. ‡∏†‡∏≤‡∏î‡∏µ‡∏•‡∏∞‡∏´‡πå ‡πÅ‡∏ß‡∏™‡∏≤‡∏°‡∏∞",
            "‡∏ô.‡∏™. ‡∏£‡∏≠‡∏ã‡∏µ‡∏î‡πä‡∏∞ ‡∏õ‡∏π‡∏ã‡∏π",
            "‡∏ô.‡∏™. ‡πÇ‡∏ô‡∏£‡∏µ‡∏ã‡∏±‡∏ô ‡πÅ‡∏à‡πà‡∏°‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏≤",
            "‡∏ô.‡∏™.‡∏ä‡∏≤‡∏£‡∏¥‡∏ì‡∏µ‡∏¢‡πå  ‡πÅ‡∏ß‡∏°‡∏∞‡πÅ‡∏ã",
            "‡∏ô.‡∏™.‡∏ã‡∏π‡πÑ‡∏Æ‡∏•‡∏≤  ‡∏≠‡∏π‡πÄ‡∏ã‡πá‡∏á",
            "‡∏ô.‡∏™.‡∏ü‡∏¥‡∏£‡πÄ‡∏î‡∏≤‡∏™‡πå  ‡∏≠‡∏≤‡πÅ‡∏ß",
            "‡∏ô.‡∏™.‡∏ß‡∏£‡∏≤‡∏£‡∏±‡∏ï‡∏ô‡πå ‡πÅ‡∏ã‡πà‡πÄ‡∏ï‡∏µ‡∏¢‡∏ß",
            "‡∏ô.‡∏™.‡∏≠‡∏≤‡∏ô‡∏¥‡∏™‡∏≤  ‡πÄ‡∏•‡∏≤‡∏∞‡∏ã‡∏≤",
            "‡∏ô‡∏≤‡∏á‡∏ü‡∏≤‡∏£‡∏µ‡∏î‡∏≤  ‡πÄ‡∏ï‡πâ‡∏á‡∏ä‡∏π",
            "‡∏ô‡∏≤‡∏¢  ‡∏°‡∏π‡∏Æ‡∏±‡∏°‡∏´‡∏°‡∏±‡∏î‡∏≠‡∏≤‡∏ö‡∏µ‡∏î‡∏µ‡∏ô ‡∏´‡∏∞‡∏°‡∏∞",
            "‡∏ô‡∏≤‡∏¢ ‡∏°‡∏π‡∏Æ‡∏±‡∏°‡∏´‡∏°‡∏±‡∏î‡∏Å‡∏≤‡∏î‡∏≤‡∏ü‡∏µ ‡∏°‡∏∞‡πÄ‡∏ã‡πá‡∏á",
            "‡∏ô‡∏≤‡∏¢ ‡∏≠‡∏ô‡∏∏‡∏™‡∏£‡∏ì‡πå ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÇ‡∏™‡∏†‡∏≤",
            "‡∏ô‡∏≤‡∏¢‡∏ã‡∏π‡∏î‡∏¥‡∏á  ‡∏Æ‡∏≤‡∏ã‡∏≤",
            "‡∏ô‡∏≤‡∏¢‡∏°‡∏∞‡∏ã‡∏≤‡∏Å‡∏µ  ‡∏à‡∏∞‡∏õ‡∏∞‡∏Å‡∏µ‡∏¢‡∏≤",
            "‡∏ô‡∏≤‡∏¢‡∏°‡∏π‡∏Æ‡∏±‡∏°‡∏´‡∏°‡∏±‡∏î‡∏£‡∏∏‡∏™‡∏•‡∏µ  ‡∏Å‡∏≤‡∏ã‡∏≠",
            "‡∏ô‡∏≤‡∏¢‡∏°‡∏π‡∏Æ‡∏≥‡∏°‡∏±‡∏î  ‡∏≠‡∏±‡∏ö‡∏î‡∏∏‡∏•‡πÄ‡∏•‡∏≤‡∏∞",
            "‡∏ô‡∏≤‡∏¢‡∏°‡∏π‡∏Æ‡∏≥‡∏°‡∏±‡∏î‡∏ã‡∏≤‡∏Å‡∏µ  ‡∏™‡∏∞‡∏ô‡∏¥",
            "‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡πÑ‡∏ö‡∏î‡∏µ  ‡∏°‡∏∞‡∏ô‡∏≠‡∏£‡πå",
            "‡∏ô‡∏≤‡∏¢‡∏≠‡∏≤‡∏°‡∏¥  ‡∏≠‡∏∏‡∏°‡∏≤",
            "‡∏ô‡∏≤‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏°‡∏∞  ‡∏î‡∏≠‡πÄ‡∏•‡∏≤‡∏∞"
        ];

        // Variables to track uploaded files
        let uploadedFiles = {};
        let existingRecords = {}; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß
        let currentRecordId = null; // ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        let fileCount = 0;
        const totalFiles = 4;

        // Document type mappings
        const documentTypes = {
            'sms': '‡∏£‡∏π‡∏õ SMS',
            'checklist': '‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö',
            'ddms': '‡πÉ‡∏ö‡∏ï‡∏±‡∏î‡∏Ç‡∏≤‡∏¢ DDMS',
            'tax': '‡πÉ‡∏ö‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ'
        };

        // Initialize the application
        function initializeApp() {
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô dropdown
            const salesPersonSelect = document.getElementById('salesPerson');
            salesPeopleList.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                salesPersonSelect.appendChild(option);
            });

            // Initialize file input handlers
            document.querySelectorAll('.file-input').forEach(input => {
                input.addEventListener('change', handleFileUpload);
            });

            // Load existing records from localStorage simulation
            loadExistingRecords();
            
            updateProgress();
        }

        // Load existing records (simulation)
        function loadExistingRecords() {
            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å database ‡∏´‡∏£‡∏∑‡∏≠ API)
            existingRecords = {
                'record1': {
                    id: 'record1',
                    salesPerson: '‡∏ô‡∏≤‡∏¢‡∏≠‡∏≤‡∏°‡∏¥  ‡∏≠‡∏∏‡∏°‡∏≤',
                    customerName: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC ‡∏à‡∏≥‡∏Å‡∏±‡∏î',
                    files: ['sms', 'checklist'],
                    timestamp: '2025-06-19 10:30'
                },
                'record2': {
                    id: 'record2',
                    salesPerson: '‡∏ô.‡∏™. ‡∏Å‡∏±‡∏ô‡∏ï‡∏µ‡∏ì‡∏µ‡∏¢‡πå ‡πÄ‡∏à‡πä‡∏∞‡πÅ‡∏ß',
                    customerName: '‡∏´‡πâ‡∏≤‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô XYZ',
                    files: ['ddms'],
                    timestamp: '2025-06-19 14:20'
                }
            };
        }

        // Search existing documents
        function searchExistingDocuments() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const searchResults = document.getElementById('searchResults');
            
            if (searchTerm.length < 2) {
                searchResults.style.display = 'none';
                return;
            }

            const results = Object.values(existingRecords).filter(record => 
                record.salesPerson.toLowerCase().includes(searchTerm) ||
                record.customerName.toLowerCase().includes(searchTerm)
            );

            if (results.length > 0) {
                searchResults.innerHTML = '<h4>üìÑ ‡∏û‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß:</h4>';
                results.forEach(record => {
                    const recordDiv = document.createElement('div');
                    recordDiv.className = 'existing-record';
                    recordDiv.onclick = () => loadExistingRecord(record);
                    
                    const filesBadges = record.files.map(type => 
                        `<span class="badge">${documentTypes[type]}</span>`
                    ).join('');
                    
                    recordDiv.innerHTML = `
                        <div class="record-info">
                            <div>
                                <strong>${record.salesPerson}</strong> - ${record.customerName}
                                <div class="record-details">
                                    ‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ${record.files.length}/4 ‡∏ä‡∏¥‡πâ‡∏ô - ${record.timestamp}
                                </div>
                            </div>
                            <div>${filesBadges}</div>
                        </div>
                    `;
                    searchResults.appendChild(recordDiv);
                });
                searchResults.style.display = 'block';
            } else {
                searchResults.innerHTML = '<p>‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>';
                searchResults.style.display = 'block';
            }
        }

        // Load existing record for editing
        function loadExistingRecord(record) {
            currentRecordId = record.id;
            
            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('salesPerson').value = record.salesPerson;
            document.getElementById('customerName').value = record.customerName;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
            fileCount = 0;
            uploadedFiles = {};
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            document.querySelectorAll('.document-card').forEach(card => {
                card.classList.remove('uploaded', 'found');
            });
            document.querySelectorAll('.file-preview').forEach(preview => {
                preview.style.display = 'none';
            });
            
            // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
            record.files.forEach(type => {
                const card = document.querySelector(`[data-type="${type}"]`);
                const preview = document.getElementById(`preview-${type}`);
                
                card.classList.add('found');
                preview.style.display = 'block';
                preview.innerHTML = `
                    <strong>‚úÖ ‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß</strong><br>
                    <small>üìÖ ${record.timestamp}</small>
                `;
                
                // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                uploadedFiles[type] = {
                    existing: true,
                    name: `${documentTypes[type]}_${record.timestamp}`,
                    recordId: record.id
                };
                fileCount++;
            });
            
            updateProgress();
            showNotification('üìÇ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            document.getElementById('searchResults').style.display = 'none';
        }

        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            const type = event.target.dataset.type;
            const card = event.target.closest('.document-card');
            const preview = document.getElementById(`preview-${type}`);

            if (file) {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const wasExisting = uploadedFiles[type] && uploadedFiles[type].existing;
                const hadFile = uploadedFiles[type] !== undefined;
                
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° count
                if (!hadFile) {
                    fileCount++;
                }

                // Store file information
                uploadedFiles[type] = {
                    file: file,
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    existing: false
                };

                // Update card appearance
                card.classList.remove('found');
                card.classList.add('uploaded');
                
                // Show file preview
                preview.style.display = 'block';
                preview.innerHTML = `
                    <strong>‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà:</strong> ${file.name}<br>
                    <strong>‡∏Ç‡∏ô‡∏≤‡∏î:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                    <strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${file.type}
                    ${wasExisting ? '<br><small>üîÑ ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡πà‡∏≤</small>' : ''}
                `;

                updateProgress();
                
                if (wasExisting) {
                    showNotification(`üîÑ ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà ${documentTypes[type]} ‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà`, 'warning');
                } else {
                    showNotification(`‚úÖ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î ${documentTypes[type]} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
                }
            }
        }

        // Update progress bar
        function updateProgress() {
            const progress = (fileCount / totalFiles) * 100;
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const submitBtn = document.getElementById('submitBtn');

            progressFill.style.width = progress + '%';
            progressText.textContent = `‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß ${fileCount}/${totalFiles}`;

            // Enable submit button when all files are uploaded
            if (fileCount === totalFiles) {
                submitBtn.disabled = false;
                progressText.textContent = `‚úÖ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ${fileCount}/${totalFiles}`;
                showNotification('üéâ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 4 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏•‡πâ‡∏ß! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'success');
            } else {
                submitBtn.disabled = true;
            }
        }

        // Save documents (partial save)
        function saveDocuments() {
            const salesPerson = document.getElementById('salesPerson').value;
            const customerName = document.getElementById('customerName').value;

            if (!salesPerson || !customerName) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            if (fileCount === 0) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡∏¥‡πâ‡∏ô', 'error');
                return;
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á record ID ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤
            const recordId = currentRecordId || 'record_' + Date.now();
            const timestamp = new Date().toLocaleString('th-TH');

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
            existingRecords[recordId] = {
                id: recordId,
                salesPerson: salesPerson,
                customerName: customerName,
                files: Object.keys(uploadedFiles),
                timestamp: timestamp
            };

            currentRecordId = recordId;

            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            console.log('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', {
                recordId,
                salesPerson,
                customerName,
                files: Object.keys(uploadedFiles),
                fileCount: fileCount
            });

            showNotification(`üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (${fileCount}/${totalFiles} ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)`, 'success');
        }

        // Handle form submission (complete submission)
        document.getElementById('documentForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const salesPerson = document.getElementById('salesPerson').value;
            const customerName = document.getElementById('customerName').value;

            if (!salesPerson || !customerName) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            if (fileCount < totalFiles) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 4 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó', 'error');
                return;
            }

            // Prepare data for n8n webhook
            const formData = new FormData();
            formData.append('salesPerson', salesPerson);
            formData.append('customerName', customerName);
            formData.append('timestamp', new Date().toISOString());
            formData.append('recordId', currentRecordId || 'new_' + Date.now());

            // Add all files to FormData
            Object.keys(uploadedFiles).forEach(type => {
                const fileData = uploadedFiles[type];
                if (!fileData.existing && fileData.file) {
                    formData.append(`file_${type}`, fileData.file, fileData.name);
                }
                formData.append(`fileInfo_${type}`, JSON.stringify({
                    name: fileData.name,
                    size: fileData.size || 0,
                    type: fileData.type || 'existing',
                    documentType: documentTypes[type],
                    existing: fileData.existing || false
                }));
            });

            try {
                showNotification('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ n8n...', 'success');
                
                // This is where you would send to your n8n webhook
                // Replace 'YOUR_N8N_WEBHOOK_URL' with your actual n8n webhook URL
                
                const response = await fetch('https://n8n.srv859967.hstgr.cloud/home/workflows', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    showNotification('‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏á Google Drive', 'success');
                    
                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                    if (currentRecordId && existingRecords[currentRecordId]) {
                        existingRecords[currentRecordId].completed = true;
                        existingRecords[currentRecordId].completedAt = new Date().toLocaleString('th-TH');
                    }
                    
                    setTimeout(() => {
                        resetForm();
                    }, 2000);
                } else {
                    showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                }
            } catch (error) {
                console.log('‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ n8n:', {
                    salesPerson,
                    customerName,
                    files: Object.keys(uploadedFiles),
                    recordId: currentRecordId,
                    timestamp: new Date().toISOString()
                });
                
                showNotification('‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á! (‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö)', 'success');
                
                setTimeout(() => {
                    resetForm();
                }, 2000);
            }
        });

        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Reset form
        function resetForm() {
            uploadedFiles = {};
            fileCount = 0;
            currentRecordId = null;
            
            document.getElementById('documentForm').reset();
            document.querySelectorAll('.document-card').forEach(card => {
                card.classList.remove('uploaded', 'found');
            });
            document.querySelectorAll('.file-preview').forEach(preview => {
                preview.style.display = 'none';
            });
            
            updateProgress();
            showNotification('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ä‡∏∏‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ', 'success');
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
</body>
</html> 
